<html>
<head>
<link rel="import" id="components.html" href="components.html">
<link rel="stylesheet" type="text/css" href="/css/app.css">
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/SyncNode.js"></script>
<script type="text/javascript" src="/SyncNodeSocket.js"></script>
<script type="text/javascript" src="/SyncView.js"></script>
<script type="text/javascript" src="/parse.js"></script>
</head>
<body>


<script id="view" type="text/other">

#header:Header
#categoryList:MenuItemCategoryList[col]
#categoryDetails:MenuItemCategoryDetails[col]
#itemDetails:MenuItemDetails[col]


Header[row dark]
	:style
		height: 56px;
	#title[margin1] 'Menu'
	#init:function
	#render:function

MenuItemCategoryList[col col-left col-flex]
	#list:SearchList({ text: 'Categories', ctor: 'MenuItemCategory', searchBox: true, addBtn: true, sort: 'name', searchProp: 'name' })[col-fill]
		events:
			selected(item): 
				categoryDetails.update(item);
			add(value):
				this.list.clearSearch();
				this.add(value);
				
	#add:function(name)
		var name = name || '';
		name = name.trim();
		if(!name) return;
		var newItem = { 
			key: new Date().toISOString(), 
			name: name,
			items: {} };
		var result = this.data.set(newItem.key, newItem)[newItem.key];
		this.list.select(result.key);
	#init:function
	#render:function 
		this.list.update(this.data);
		if(!this.list.selected) this.list.select(SV.toArray(this.data)[0].key);
		categoryDetails.update(this.list.selected);

MenuItemCategory[item tight]
	#nameSpan$(data.name)[name]
	#init:function
		this.node.addEventListener('click', 
			() => { this.emit('selected', this.data); });
	#render:function
		this.node.style.color = this.data.isDisabled ? '#777' : '#000';


MenuItemCategoryDetails[col col-left col-flex wide]
	#header:SimpleHeader({ "text": "Details", "close": true, 'del': true})
		events:
			close:
				this.close();
			delete:
				Modal.confirm('Delete?', '', () => {
					this.data.parent.remove(this.data.key);
					this.close();
				});
	#nameInput:Input({ prop: 'name', label: 'Name' })$(update=data)
	#noteInput:Input({ prop: 'note', label: 'Note' })$(update=data)
	#disableToggle:ToggleButton({ prop: 'isDisabled', trueText: 'Disabled', falseText: 'Enabled' })$(update=data)
	#items:MenuItemList
	#close:function
			itemDetails.close();
			this.update(null);
	#init:function
			this.render();
	#render:function
			this.node.style.display = this.data ? 'flex' : 'none';
			if(this.data) this.items.update(this.data.items);

MenuItemList[col-fill col-flex]
	#list:SearchList({ text: 'Items', ctor: 'MenuItem', searchBox: true, addBtn: true, sort: 'name', searchProp: 'name' })[col-fill]
		events:
			selected(item): 
				itemDetails.update(item);
			add(value):
				this.list.clearSearch();
				this.add(value);
	#add:function(name)
		var newItem = { 
			key: new Date().toISOString(), 
			name: name,
			options: {} };
		var result = this.data.set(newItem.key, newItem)[newItem.key];
		this.list.select(result.key);
	#render:function 
		this.list.update(this.data);
		itemDetails.update(this.list.selected);

MenuItem[item tight]
	#price[right]
	#nameSpan$(data.name)[name]
	#init:function
		this.node.addEventListener('click', 
			() => { this.emit('selected', this.data); });
	#render:function()
		this.node.style.color = this.data.isDisabled ? '#777' : '#000';
		this.price.innerHTML = SV.formatCurrency(this.data.price);


MenuItemDetails[col wide]
	#header:SimpleHeader({ text: 'Item Details', close: true, del: true})
		events:
			close:
				this.close();
			delete:
				Modal.confirm('Delete?', '', () => {
					this.data.parent.remove(this.data.key);
					this.close();
				});
	#nameInput:Input({ prop: 'name', label: 'Name' })$(update=data)
	#noteInput:Input({ prop: 'note', label: 'Note' })$(update=data)
	#disableToggle:ToggleButton({ prop: 'isDisabled' })$(update=data)
	#priceInput:Input({ prop: 'price', label: 'Price' })$(update=data)
	//#values:MenuItemOptionValues$(update=data.values)
	#close:function
			this.update(null);
	#init:function
			this.render();
	#render:function
			this.node.style.display = this.data ? 'block' : 'none';
	



</script>




<script>
"use strict"

window.Input = Input

SV.startReloader();

var sync = new SyncNodeSocket('/data', {});


SV.onLoad(() => { 
		importCode('components.html'); 
		parse(SV.id('view').innerHTML); 

		sync.on('updated', (data) => {
			if(!data.menu) {
				data.set('menu', { 
					categories: {}, 
					items: {} 
				});
			} else { 
				categoryList.update(data.menu.categories);
			}
		});
});

</script>
</body>
</html>
