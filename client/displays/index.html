<!DOCTYPE html>
<html>
<head>
<style type="text/css">
body {
	overflow:hidden;
	color:#333;
	background-color:#FFF;
	font-weight:bold;
	font-family:Verdana, Geneva, sans-serif;
	font-size:40px;
	text-align: center;
}

.sign {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	transition: opacity 2s;
}

.center {
	margin-left: auto;
	margin-right: auto;
}

.hide {
	opacity: 0;
}

</style>
<title>Digital Signage</title>
</head>
<body>
<div id="sign1" class="sign">
	<h1>Happy New Year!</h1>
	<img src="http://www.thecoalyard.com/logo.png" style="width: 400px"  />
</div>
<div id="sign2" class="sign hide">
	<h1>Chef Meares New Year's Special</h1>
	<h4>Applewood Smoked Ribs</h4>
	<h4>Black-eyed Peas</h4>
	<h4>Collard Greens</h4>
	<h4>Cornbread</h4>
</div>
<div id="sign3" class="sign hide">
	<h1>Upcoming Events</h1>
</div>
<div id="sign4" class="sign hide">
	<h1>Sign 4</h1>
</div>
<script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
<script type="text/javascript">

var signs = ['sign2', 'sign1'];


var currentIndex = 0;
var timer;
function cycle() {
	currentIndex = 0;
	displaySign(signs[currentIndex]);
	timer = setInterval(function() {
		currentIndex += 1;
		if(currentIndex >= signs.length) currentIndex = 0;
		displaySign(signs[currentIndex]);
	}, 5000);
}
function stopCycle() {
	clearTimeout(timer);
}


function displaySign(id) {
	signs.forEach(function(signId) {
		if(signId !== id) document.getElementById(signId).classList.add('hide');			
	});
	//setTimeout(function() {
		document.getElementById(id).classList.remove('hide');
	//}, 1000);
}

window.onload = function() {

	


	cast.receiver.logger.setLevelValue(0);
	window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
	console.log('Starting Receiver Manager');

	// handler for the 'ready' event
	castReceiverManager.onReady = function(event) {
		console.log('Received Ready event: ' + JSON.stringify(event.data));
		cycle();
		window.castReceiverManager.setApplicationState("Digital Sign is ready...");
	};

	// handler for 'senderconnected' event
	castReceiverManager.onSenderConnected = function(event) {
		console.log('Received Sender Connected event: ' + event.data);
		console.log(window.castReceiverManager.getSender(event.data).userAgent);
	};

	// handler for 'senderdisconnected' event
	castReceiverManager.onSenderDisconnected = function(event) {
		console.log('Received Sender Disconnected event: ' + event.data);
		//if (window.castReceiverManager.getSenders().length == 0) {
		//	window.close();
		//}
	};

	// create a CastMessageBus to handle messages for a custom namespace
	window.messageBus =
		window.castReceiverManager.getCastMessageBus(
				'urn:x-cast:com.google.cast.sample.helloworld');

	// handler for the CastMessageBus message event
	window.messageBus.onMessage = function(event) {
		console.log('Message [' + event.senderId + ']: ' + event.data);
		// display the message from the sender
		var command = event.data;
		console.log(command);
		switch(command) {
			case 'cycle':
				cycle();
				break;
			case 'stop cycle':
				stopCycle();
				break;
			default:
				displaySign(command);
		}
		
		window.castReceiverManager.setApplicationState('Displaying: ' + id);
		// inform all senders on the CastMessageBus of the incoming message event
		// sender message listener will be invoked
		window.messageBus.send(event.senderId, event.data);
	}

	// initialize the CastReceiverManager with an application status message
	window.castReceiverManager.start({statusText: "Application is starting"});
	console.log('Receiver Manager started');
};
</script>
</body>
</html>
