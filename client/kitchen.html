<html>
<head>
<link rel="stylesheet" type="text/css" href="/css/app.css">
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/bower_components/moment/moment.js"></script>
<script type="text/javascript" src="/SyncNode.js"></script>
<script type="text/javascript" src="/SyncNodeSocket.js"></script>
<script type="text/javascript" src="/SyncView.js"></script>
<script type="text/javascript" src="/parse.js"></script>
<link rel="import" id="components.html" href="/components.html">
<link rel="import" id="kitchenComponents.html" href="/kitchenComponents.html">
</head>
<body style="background-color: #444">

<audio src="/imgs/sounds/bell.mp3" preload="auto" id="bell"></audio>

<script id="view" type="text/other">

#header:Header
#kitchenOrders:KitchenOrders


	
Header[row row-flex dark]
	:style
		z-index: 1;
		height: 56px;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
	#stationSelect:Select({ values: ['Grill', 'Line', 'Server'] })[row-nofill margin1]
		style:
			width: 239px;
		events:
			selected(station):
				window.recSettings.set('kitchenStation', station);
	:div[row-fill margin1] 'Kitchen'
	:div[row-nofill touch material-icons] 'settings'
		events:
			click:
				Modal.confirm('Delete all kitchen orders?', '', () => {
					console.log('this.data', this.data);
					this.data.kitchen.remove('orders');
				});
	#init:function
	#render:function
		
		

KitchenOrders
	:style
		margin-top: 56px;
	#list:List({ ctor: 'KitchenOrder', sort: 'submittedAt' })
	#render:function
		this.list.update(this.data)


</script>




<script>
"use strict"

window.Input = Input;

//SV.startReloader();

var sync = new SyncNodeSocket('/data', {});
var eventsServer = new SyncNodeSocket('/events', {});
window.recSettings = new LocalSyncNode('recSettings');	

eventsServer.server.on('play kitchen bell', function() {
	SV.id('bell').play();
});

SV.onLoad(() => { 

		importCode('components.html'); 
		importCode('kitchenComponents.html'); 
		parse(SV.id('view').innerHTML); 
			
		header.stationSelect.select(window.recSettings.kitchenStation);

		sync.on('updated', (data) => {
			if(!data.kitchen) data.set('kitchen', {});
			if(!data.kitchen.orders) data.kitchen.set('orders', {});
			header.update(data);
			kitchenOrders.update(data.kitchen.orders);
		});
		
	
		window.recSettings.on('updated', (data) => {
			header.stationSelect.select(data.kitchenStation);
		});
});


</script>
</body>
</html>
