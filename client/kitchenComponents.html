<script id="kitchenComponents" type="text/other">

KitchenOrder[left]
	:style
		background-color: #FFF;
		width: 350px;
		min-height: 200px;
		border: 1px solid rgba(0,0,0,1);
		position: relative;
	:events
		click:
			if(this.data.serveType === 'Bar') {
				this.data.completedAt.set('Bar', new Date().toISOString());
			}
			else if(!this.data.completedAt[window.recSettings.kitchenStation]) {
				this.data.completedAt.set(window.recSettings.kitchenStation, new Date().toISOString());
			}
	#progressGrill
		style:
			position: absolute;
			top: 0;
			left: 0;
			height: 10px;
			background-color: #0F0;
	#progressLine
		style:
			position: absolute;
			top: 10;
			left: 0;
			height: 8px;
			background-color: #4F4;
	#progressServer
		style:
			position: absolute;
			top: 18;
			left: 0;
			height: 10px;
			background-color: #7F7;
	#orderTime[row tight right padding1]
		style:
			position: relative;
	#header[row tight padding1 border-bottom]
		style:
			position: relative;
	#list:List({ ctor: 'KitchenOrderItem' })
	#dimmer:div
		style:
			position: absolute;
			top: 0; bottom: 0; left: 0; right: 0;
			background-color: rgba(0,0,0,0.4);
	#updateOrderTimeHelper:function(completedAt, el)
		var now = completedAt ? moment(completedAt) : moment();
		var submitted = moment(this.data.submittedAt);
		var d = moment.duration(now.diff(submitted));
		var m = d.asMilliseconds();
		this.orderTime.innerHTML = moment(m).format('m:ss');
		var target = 20 * 60 * 1000;
		var progress = m/target;
		if(progress > 1) progress = 1;
		el.style.backgroundColor = (progress === 1) ? '#F00' : '#0F0'; 
		el.style.width = (progress * 100).toPrecision(1) + '%';
	#updateOrderTime:function
		if(this.data.serveType === 'Bar') {
			this.updateOrderTimeHelper(this.data.completedAt['Bar'], this.progressGrill);
			this.updateOrderTimeHelper(this.data.completedAt['Bar'], this.progressLine);
			this.updateOrderTimeHelper(this.data.completedAt['Bar'], this.progressServer);
			this.dimmer.classList.toggle('hide', !this.data.completedAt['Bar']);
		} else {
			this.updateOrderTimeHelper(this.data.completedAt['Grill'], this.progressGrill);
			this.updateOrderTimeHelper(this.data.completedAt['Line'], this.progressLine);
			this.updateOrderTimeHelper(this.data.completedAt['Server'], this.progressServer);
			this.dimmer.classList.toggle('hide', !this.data.completedAt[window.recSettings.kitchenStation]);
		}
	#render:function
		this.header.innerHTML = this.data.table + ' ' + this.data.name;
		this.list.update(this.data.orderItems);
		this.updateOrderTime();
		var completedAt = this.data.completedAt['Server'];
		console.log('completedAt', completedAt);
		if(!completedAt && !this.orderTimer) {
			console.log('     setting timer');
			this.orderTimer = setInterval(() => { this.updateOrderTime(); }, 1000);
		} else if(completedAt && this.orderTimer) {
			console.log('     clearing timer');
			clearInterval(this.orderTimer);
			this.orderTimer = null;	
		}


KitchenOrderItem[row tight]
	:style
		line-height: 20px;
	#temp[margin1]
		style:
			display: inline-block;
			width: 2em;
	#nameSpan
		style:
			display: inline-block;
	#side[right margin1]
	#options[margin4 whitespace-pre]
	#noteSpan$(data.note)[italic margin4 whitespace-pre]
	#render:function
		var quantity = this.data.quantity != 1 ? this.data.quantity + 'x' : '';
		this.nameSpan.innerHTML = `<span style="color: #F00; font-weight: bold; display: inline-block;">${quantity}</span><span class="bold">${this.data.name}</span>`
		var optionsText = '';
		SV.forEach(this.data.options, (option) => { 
			if(option.name === 'Temp' ) { this.temp.innerHTML = option.value; }
			else if(option.name === 'Side') { this.side.innerHTML = option.value; }
			else if(option.name === 'Dressing') {  }
			else { optionsText += option.value + '\n'; }
		});
		this.options.innerHTML = optionsText;


		
</script>
