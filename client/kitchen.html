<html>
<head>
<link rel="stylesheet" type="text/css" href="/css/app.css">
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/bower_components/moment/moment.js"></script>
<script type="text/javascript" src="/SyncNode.js"></script>
<script type="text/javascript" src="/SyncNodeSocket.js"></script>
<script type="text/javascript" src="/SyncView.js"></script>
<script type="text/javascript" src="/parse.js"></script>
<link rel="import" id="components.html" href="/components.html">
<link rel="import" id="kitchenComponents.html" href="/kitchenComponents.html">
</head>
<body style="background-color: #444">

<audio src="/imgs/sounds/bell.mp3" preload="auto" id="bell"></audio>

<script id="view" type="text/other">

#header:Header
#kitchenOrders:KitchenOrders


	
Header[row dark]
	:style
		z-index: 1;
		height: 56px;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
	:div[left margin1] 'Kitchen'
	:div[row-nofill touch material-icons row-right] 'settings'
		events:
			click:
				//Modal.confirm('Delete all kitchen orders?', '', () => {
				//	this.data.kitchen.remove('orders');
				//});
	#init:function
	#render:function
		

KitchenOrders
	:style
		margin-top: 56px;
	#list:List({ ctor: 'KitchenOrder', sort: 'submittedAt' })
	#render:function
		console.log('updating kitchenorders!', this.data);
		this.list.update(this.data)


</script>




<script>
"use strict"

window.Input = Input;

//SV.startReloader();

var sync = new SyncNodeSocket('/data', {});
var eventsServer = new SyncNodeSocket('/events', {});
window.recSettings = new LocalSyncNode('recSettings');	
console.log('rec settings', window.recSettings);

eventsServer.server.on('play kitchen bell', function() {
	SV.id('bell').play();
});

SV.onLoad(() => { 

		importCode('components.html'); 
		importCode('kitchenComponents.html'); 
		parse(SV.id('view').innerHTML); 

		function updateRec(data) {
			var rec = (data || sync.data).reconciliations[window.recSettings.selectedRecKey];
			console.log('update rec', rec);
			if(rec) {
				header.update(rec);			
				if(rec.kitchen) { 
					if(!rec.kitchen.orders) rec.kitchen.set('orders', {});
					else kitchenOrders.update(rec.kitchen.orders);
				}
			}
		}

		sync.on('updated', (data) => {
			console.log('data', data);
			updateRec();
		});
		
	
		window.recSettings.on('updated', (data) => {
			updateRec(data);
		});
});


</script>
</body>
</html>
